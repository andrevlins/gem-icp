var icpbravoaccess_ie=null,icpBravoAccessExt=function(){function t(n,t){return{statusMessage:"NÃ£o foi possÃ­vel localizar o parÃ¢metro : ["+n+"] na chamada ao mÃ©todo : "+t}}function d(n){return n.thumbprint?n.onSuccess?void 0:t("onSuccess","certificate"):t("thumbprint","certificate")}function g(n){if(!n.onSuccess)return t("onSuccess","certificates")}function nt(n){return n.thumbprint?n.toSign?n.onSuccess?void 0:t("onSuccess","sign"):t("toSign","sign"):t("thumbprint","sign")}function tt(n){return n.toDecrypt?n.thumbprint?void 0:t("thumbprint","decrypt"):t("toDecrypt","decrypt")}function it(n){return n.toEncrypt?n.thumbprint?void 0:t("thumbprint","encrypt"):t("toEncrypt","encrypt")}function rt(n){if(!n.thumbprint)return t("thumbprint","remove")}function ut(n){return n.onNotInstalled?n.onSuccess?void 0:t("onSuccess","connect"):t("onNotInstalled","connect")}function f(n){s&&console.log(n)}var s=!1,h="0.7",c="0.7",u={Default:0,IE:1,Chrome:2,Firefox:3},n={BROWSER_NOT_SUPPORTED:0,EXTENSION_NOT_INSTALLED:1,NATIVE_NOT_INSTALLED:2,NATIVE_OUTDATED:3,JS_OUTDATED:4,INSTALLED:5},r=new function(){function v(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function y(n,t,i){return{command:t,requestId:i,license:icpBravoAccessExt.license,domain:window.location.hostname,content:JSON.stringify(n),browser:p()}}function p(){return l.indexOf("Chrome")>=0?u.Chrome:l.indexOf("Firefox")>=0?u.Firefox:l.indexOf("IE")>=0?u.IE:void 0}var s={Error:0,Success:1},l=function(){var i=navigator.userAgent,t,n=i.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(t=/\brv[ :]+(\d+)/g.exec(i)||[],"IE "+(t[1]||"")):n[1]==="Chrome"&&(t=i.match(/\b(OPR|Edge)\/(\d+)/),t!=null)?t.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],(t=i.match(/version\/(\d+)/i))!=null&&n.splice(1,1,t[1]),n.join(" "))}(),r,t,o,a,e;switch(p()){case u.Chrome:case u.Firefox:var t={},w="com.scytl.icpbravoaccess.request",b="com.scytl.icpbravoaccess.response",o=function(n,i,r){var u=v(),s={callback:n,requestTime:new Date},e,o;t[u]=s;e=y(i,r,u);f("Command: "+r+" uuid: "+u);o=new CustomEvent(w,{detail:e});document.dispatchEvent(o)};function k(t,u){var f=_callbackRegister({onSuccess:function(i){i.instalationStatus===n.NATIVE_OUTDATED?(t._dispatchSuccess(i),r(t,u)):t._dispatchSuccess(i)},onError:function(i){i.instalationStatus===n.NATIVE_NOT_INSTALLED?(t._dispatchSuccess(i),r(t,u)):i.notInstalled?(i.instalationStatus=n.NATIVE_NOT_INSTALLED,t._dispatchSuccess(i),r(t,u)):t._dispatchSuccess(i)}});o(f,u,i.check)}r=function(t,u){var f=_callbackRegister({onSuccess:function(i){i.instalationStatus===n.NATIVE_OUTDATED?setTimeout(function(){r(t,u)},1e3):t._dispatchSuccess(i)},onError:function(){setTimeout(function(){r(t,u)},1e3)}});o(f,u,i.check)};e=function(t,i){var r,u;if(f("Remaining tries: "+i),r=document.getElementById("icpbravoaccess_loaded"),r===null){i>1?setTimeout(function(){e(t,i-1)},200):t._dispatchSuccess({instalationStatus:n.EXTENSION_NOT_INSTALLED});return}u={jsClientVersion:h};k(t,u)};document.addEventListener(b,function(n){var i=n.detail,r=t[i.requestId],u;r&&(delete t[i.requestId],f("Response uuid: "+i.requestId),i.statusCode===s.Error?r.callback._dispatchError(i):i.statusCode===s.Success&&(u=JSON.parse(i.content),r.callback.onReceiveReponse&&(u=r.callback.onReceiveReponse(u)),r.callback._dispatchSuccess(u)))});break;case u.IE:t={};e=function(t,i){if(f("Remaining tries: "+i),typeof icpbravoaccess_ie=="undefined"||icpbravoaccess_ie===null){i>1?setTimeout(function(){e(t,i-1)},200):t._dispatchSuccess({instalationStatus:n.EXTENSION_NOT_INSTALLED});return}var r={jsClientVersion:h,ieMinSupportedVersion:c};d(t,r)};function d(n,t){var r=_callbackRegister({onSuccess:function(t){n._dispatchSuccess(t)},onError:function(t){n._dispatchSuccess(t)}});o(r,t,i.check)}o=function(n,i,r){var u=v(),h=y(i,r,u),e,o,s;f("Command: "+r+" uuid: "+u);e=JSON.stringify(h);o=icpbravoaccess_ie.request(e);o&&(s={callback:n,requestTime:new Date},t[u]=s)};a=function(){var o,e,r,u;if(typeof icpbravoaccess_ie!="undefined"&&icpbravoaccess_ie!==null)for(o=icpbravoaccess_ie.GetPool(),e=JSON.parse(o),r=0;r<e.length;r++){var h=e[r],n=JSON.parse(h),i=t[n.requestId];i&&(delete t[n.requestId],f("Response uuid: "+n.requestId),n.statusCode===s.Error?i.callback._dispatchError(n):n.statusCode===s.Success&&(u=JSON.parse(n.content),i.callback.onReceiveReponse&&(u=i.callback.onReceiveReponse(u)),icpbravoaccess_ie.RemovePool(n.requestId),i.callback._dispatchSuccess(u)))}setTimeout(function(){a()},300)};a();break;default:e=function(t){t._dispatchSuccess({instalationStatus:n.BROWSER_NOT_SUPPORTED})}}this.requestCommand=o;this.checkExtension=e},o;this.callbackHandle=function(n){this.onSuccess=new function(){};this.onError=new function(){};this.onReceiveReponse=null;this.angularScope=n;this._dispatchSuccess=function(n){this._safeApply(this.onSuccess,n)};this._dispatchError=function(n){this._safeApply(this.onError,n)};this._safeApply=function(n,t){if(icpBravoAccessExt.angularScope){var i=this.angularScope.$root.$$phase;i=="$apply"||i=="$digest"?n&&typeof n=="function"&&n(t):this.angularScope.$apply(n(t))}else n(t)}};this._callbackRegister=function(n){var t=new callbackHandle(icpBravoAccessExt.angularScope);return n.onSuccess&&(t.onSuccess=n.onSuccess),n.onError&&(t.onError=n.onError),n.onReceiveReponse&&(t.onReceiveReponse=n.onReceiveReponse),t};var i={certificates:"certificates",certificate:"certificate",remove:"remove",sign:"sign",check:"check",decrypt:"decrypt",encrypt:"encrypt"},l=function(t,i,r,u){switch(u.instalationStatus){case n.BROWSER_NOT_SUPPORTED:u.statusMessage="O navegador nÃ£o tem suporte para esta extensÃ£o.";u.info="Navegador nÃ£o suportado";i(u);break;case n.EXTENSION_NOT_INSTALLED:u.statusMessage="A ExtensÃ£o nÃ£o estÃ¡ instalada. Instale para continuar.";u.info="ExtensÃ£o nÃ£o Instalada";i(u);break;case n.NATIVE_NOT_INSTALLED:u.statusMessage="A aplicaÃ§Ã£o nativa nÃ£o estÃ¡ instalada. FaÃ§a o download da aplicaÃ§Ã£o e instale para continuar.";u.info="AplicaÃ§Ã£o nÃ£o Instalada";u.downloadRequired=!0;i(u);break;case n.NATIVE_OUTDATED:u.statusMessage="A aplicaÃ§Ã£o nativa estÃ¡ desatualiziada. FaÃ§a o download da versÃ£o mais atual e instale para continuar.";u.info="AtualizaÃ§Ã£o DisponÃ­vel";u.downloadRequired=!0;i(u);break;case n.JS_OUTDATED:u.statusMessage="O JavaScript Client estÃ¡ desatualizado. Entre em contato com o administrador do site.";u.info="Erro";u.downloadRequired=!1;i(u);break;case n.INSTALLED:t();break;default:u.info="Erro";u.downloadRequired=!1;r(u)}},e=function(n,t){for(var r=[],i=0;n.length>i;i++)t(n[i])&&r.push(n[i]);return r},a=function(n,t){if(!n)return t;if(n.cpf){var i=n.cpf.replace(/\./g,"").replace(/-/g,"").split("|");t.certificates=e(t.certificates,function(n){for(cpfIndex in i)if(n.cpf==i[cpfIndex])return!0;return!1})}return n.type&&(n.type=n.type.toLowerCase(),n.type.search("icpbrasil")>=0?t.certificates=e(t.certificates,function(n){return n.certType===o.ICPBrasil}):n.type.search("unknown")>=0&&(t.certificates=e(t.certificates,function(n){return n.certType===o.Unknown}))),n.valid&&(t.certificates=e(t.certificates,function(n){return n.isValid})),t};this.certificates=function(n){var t=g(n),u;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError,onReceiveReponse:function(t){return a(n.filter,t)}});r.requestCommand(u,null,i.certificates)};var v=function(n){var t=d(n),u,f;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError});f={thumbprint:n.thumbprint};r.requestCommand(u,f,i.certificate)},y=function(n){var t=nt(n),u,f;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError});f={thumbprint:n.thumbprint,toSign:n.toSign,signatureAlgorithm:n.signatureAlgorithm};r.requestCommand(u,f,i.sign)},p=function(n){var t=it(n),u,f;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError});f={thumbprint:n.thumbprint,toEncrypt:n.toEncrypt,oaep:n.oaep};r.requestCommand(u,f,i.encrypt)},w=function(n){var t=tt(n),u,f;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError});f={thumbprint:n.thumbprint,toDecrypt:n.toDecrypt,oaep:n.oaep};r.requestCommand(u,f,i.decrypt)},b=function(n){var t=rt(n),u,f;if(t){n.onError(t);return}u=_callbackRegister({onSuccess:n.onSuccess,onError:n.onError});f={thumbprint:n.thumbprint};r.requestCommand(u,f,i.remove)},k=function(n){var t=ut(n),i;if(t){n.onError(t);return}n.license&&(icpBravoAccessExt.license=n.license);n.angular&&(icpBravoAccessExt.angularScope=n.angular);i=_callbackRegister({onSuccess:function(t){l(n.onSuccess,n.onNotInstalled,n.onError,t)},onError:function(t){n.onError(t)}});r.checkExtension(i,25)};return o={Unknown:0,ICPBrasil:1},{connect:k,getCertificateList:certificates,getCertificate:v,sign:y,remove:b,encrypt:p,decrypt:w,enableLog:s}}();
